<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å…­ç¸åˆ†æç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @media print {
      body { background:#fff !important; }
      .no-print { display:none !important; }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <div class="p-6 max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">å…­ç¸ Ã— å…­è¦ª Ã— åœ°æ”¯ åˆ†æç³»çµ±</h1>

    <!-- æ¨¡å¼åˆ‡æ› -->
    <div class="mb-4">
      <label class="mr-2 font-bold">åˆ†ææ¨¡å¼ï¼š</label>
      <select id="mode" class="border rounded p-2">
        <option value="single">å–®äººåˆ†æ</option>
        <option value="dual">é›™äººåˆ†æ</option>
      </select>
    </div>

    <!-- äººç‰© A -->
    <div class="grid grid-cols-3 gap-2 mb-4">
      <div>
        <label>å…­ç¸(A)</label>
        <select id="aBeast" class="w-full border rounded p-2">
          <option>é’é¾</option><option>æœ±é›€</option><option>å‹¾é™³</option>
          <option>è£è›‡</option><option>ç™½è™</option><option>ç„æ­¦</option>
        </select>
      </div>
      <div>
        <label>å…­è¦ª(A)</label>
        <select id="aKin" class="w-full border rounded p-2">
          <option>çˆ¶æ¯</option><option>å…„å¼Ÿ</option><option>å­å­«</option>
          <option>å¦»è²¡</option><option>å®˜é¬¼</option>
        </select>
      </div>
      <div>
        <label>åœ°æ”¯(A)</label>
        <select id="aBranch" class="w-full border rounded p-2">
          <option>å­</option><option>ä¸‘</option><option>å¯…</option><option>å¯</option>
          <option>è¾°</option><option>å·³</option><option>åˆ</option><option>æœª</option>
          <option>ç”³</option><option>é…‰</option><option>æˆŒ</option><option>äº¥</option>
        </select>
      </div>
    </div>

    <!-- äººç‰© B -->
    <div id="dualFields" class="grid grid-cols-3 gap-2 mb-4 hidden">
      <div>
        <label>å…­ç¸(B)</label>
        <select id="bBeast" class="w-full border rounded p-2">
          <option>é’é¾</option><option>æœ±é›€</option><option>å‹¾é™³</option>
          <option>è£è›‡</option><option>ç™½è™</option><option>ç„æ­¦</option>
        </select>
      </div>
      <div>
        <label>å…­è¦ª(B)</label>
        <select id="bKin" class="w-full border rounded p-2">
          <option>çˆ¶æ¯</option><option>å…„å¼Ÿ</option><option>å­å­«</option>
          <option>å¦»è²¡</option><option>å®˜é¬¼</option>
        </select>
      </div>
      <div>
        <label>åœ°æ”¯(B)</label>
        <select id="bBranch" class="w-full border rounded p-2">
          <option>å­</option><option>ä¸‘</option><option>å¯…</option><option>å¯</option>
          <option>è¾°</option><option>å·³</option><option>åˆ</option><option>æœª</option>
          <option>ç”³</option><option>é…‰</option><option>æˆŒ</option><option>äº¥</option>
        </select>
      </div>
    </div>

    <!-- æƒ…å¢ƒé¸å–® -->
    <div class="mb-4">
      <label class="mr-2 font-bold">æƒ…å¢ƒï¼š</label>
      <select id="context" class="border rounded p-2">
        <option>è·å ´äº’å‹•</option>
        <option>æ„›æƒ…</option>
        <option>æ€§æ„›</option>
        <option>å¥åº·</option>
      </select>
    </div>

    <!-- åŠŸèƒ½æŒ‰éˆ• -->
    <div class="mb-4 space-x-2">
      <button onclick="runAnalyze()" class="px-4 py-2 bg-blue-600 text-white rounded">é–‹å§‹åˆ†æ</button>
      <button onclick="toggleBg()" class="px-4 py-2 bg-gray-600 text-white rounded">åˆ‡æ›èƒŒæ™¯</button>
      <button onclick="window.print()" class="px-4 py-2 bg-green-600 text-white rounded no-print">åˆ—å°</button>
    </div>

    <!-- åˆ†æçµæœ -->
    <div id="result" class="p-4 border rounded bg-white">
      <h2 class="text-xl font-bold mb-2">åˆ†æçµæœï¼š</h2>
      <pre id="output" class="whitespace-pre-wrap"></pre>
      <div id="healthTips" class="mt-4 text-red-700 font-semibold"></div>
      <canvas id="radarChart" class="mt-4"></canvas>
    </div>
  </div>

<script>
let bgToggle = false;

// æ¨¡å¼åˆ‡æ› â†’ é¡¯ç¤º/éš±è—äººç‰©B
document.getElementById("mode").addEventListener("change", e=>{
  document.getElementById("dualFields").style.display = 
    e.target.value === "dual" ? "grid" : "none";
});

// åˆ‡æ›èƒŒæ™¯é¡è‰²
function toggleBg(){
  bgToggle = !bgToggle;
  document.body.className = bgToggle ? "bg-yellow-100" : "bg-gray-50";
}

// åŸ·è¡Œåˆ†æ
async function runAnalyze(){
  const mode = document.getElementById("mode").value;
  const context = document.getElementById("context").value;

  const data = {
    mode,
    aBeast: document.getElementById("aBeast").value,
    aKin: document.getElementById("aKin").value,
    aBranch: document.getElementById("aBranch").value,
    bBeast: document.getElementById("bBeast")?.value,
    bKin: document.getElementById("bKin")?.value,
    bBranch: document.getElementById("bBranch")?.value,
    context
  };

  const res = await fetch("/api/analyze", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(data)
  });
  const json = await res.json();
  document.getElementById("output").textContent = json.text || JSON.stringify(json);

  // é¡¯ç¤ºå¥åº·å»ºè­°
  if(context === "å¥åº·"){
    const branch = document.getElementById("aBranch").value;
    let tips = "ğŸ’¡ å¥åº·æ¹¯è—¥å»ºè­°ï¼š";
    if(["å­","äº¥"].includes(branch)) tips += " è…æ°´åå¼±ï¼Œå¯ç”¨ã€Šå®‰è¿ªæ¹¯ã€‹ã€Šå…­å‘³åœ°é»ƒä¸¸ã€‹è£œè…ã€‚";
    else if(["å¯…","å¯"].includes(branch)) tips += " æœ¨æ°£ä¸è¶³ï¼Œå¯ç”¨ã€Šå››ç¥æ¹¯ã€‹ã€ŠåŠ å‘³é€é™æ•£ã€‹èª¿è‚è„¾ã€‚";
    else if(["å·³","åˆ"].includes(branch)) tips += " ç«æ°£æ—ºï¼Œå¯ç”¨ã€Šé…¸æ£—ä»æ¹¯ã€‹ã€Šæ¸…å¿ƒè“®å­é£²ã€‹é¤Šå¿ƒå®‰ç¥ã€‚";
    else if(["ç”³","é…‰"].includes(branch)) tips += " é‡‘æ°£åå¼±ï¼Œå¯ç”¨ã€Šæ¡‘èŠé£²ã€‹ã€ŠéŠ€ç¿¹æ•£ã€‹è­·è‚ºæ°£ã€‚";
    else if(["ä¸‘","è¾°","æœª","æˆŒ"].includes(branch)) tips += " åœŸæ°£ä¸è¶³ï¼Œå¯ç”¨ã€Šè£œä¸­ç›Šæ°£æ¹¯ã€‹ã€Šé¦™ç ‚å…­å›å­æ¹¯ã€‹å¥è„¾èƒƒã€‚";
    document.getElementById("healthTips").textContent = tips;
  } else {
    document.getElementById("healthTips").textContent = "";
  }

  // é›·é”åœ–ï¼šé›™äººæ¨¡å¼æ‰é¡¯ç¤º
  if(mode==="dual" && json.scores){
    renderRadar(json.scores);
  }
}

let radarChart;
function renderRadar(scores){
  const ctx = document.getElementById("radarChart").getContext("2d");
  if(radarChart) radarChart.destroy();
  radarChart = new Chart(ctx, {
    type:"radar",
    data:{
      labels:["å¥‘åˆ","æºé€š","ç¯€å¥","è²¬ä»»","ä¿¡ä»»","å‰µæ–°"],
      datasets:[{
        label:"é›™äººäº’å‹•åˆ†æ•¸",
        data:[scores.fit, scores.comm, scores.pace, scores.account, scores.trust, scores.innov],
        fill:true,
        borderColor:"rgb(54,162,235)",
        backgroundColor:"rgba(54,162,235,0.2)"
      }]
    }
  });
}
</script>

</body>
</html>
